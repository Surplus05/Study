# 전역 상태관리는 꼭 필요한가

무의식적으로 props drilling은 무조건 나쁜거고, 상태관리 라이브러리를 사용하면 해결할 수 있다는 글을 보고 나도 모르게 props drilling 은 무조건 나쁜거라고 생각하게 되었었다.

모든 상태를 전역 상태관리로 통합해 recoil이나 redux의 볼륨이 지나치게 거대화 되는 경우를 종종 겪었다.

data-fetching 관련 라이브러리인 react-query를 연습해보게 되면서 전역 상태관리에 대한 필요성이 점점 낮아짐을 느끼고 있다.

```ts
const [data, setData] = useRecoilState(dataState);

useEffect(() => {
  const fetchData = async () => {
    try {
      const response = await fetch(API_URL);
      if (!response.ok) {
        throw new Error("오류 발생");
      }
      const result = await response.json();
      setData(result);
    } catch (error) {
      // 에러 발생
    }
  };

  fetchData();
}, []);

return <div></div>;
```

fetch 하고, data에 저장해주고 있다.

컴포넌트에서는 data를 가져와 사용하면 되는데, 항상 initialState를 고려(널체크)해야 한다.

```ts
const { data, error, isLoading } = useQuery("fetchData", fetchData);
```

useQuery 를 사용한다면, 이러한 단점이 사라지게 된다.

정리하자면, fetched data를 전역 상태에 매핑할 필요가 없어진다.  
새로 fetch하면 캐싱 되어있기에 중복 fetch 또한 발생하지 않는다.

즉 다른 요소에서

```ts
useEffect(() => {
  const fetchData = async () => {
    try {
      const response = await fetch(API_URL);
      if (!response.ok) {
        throw new Error("오류 발생");
      }
      const result = await response.json();
      setData(result);
    } catch (error) {
      // 에러 발생
    }
  };

  fetchData();
}, []);
```

데이터를 fetching해 전역 상태에 저장하고

```ts
const [data, setData] = useRecoilState(dataState);

if (!data) return;

return <>{data}</>;
```

널 체크후 사용하는 과정을 간편하게 해주는 것이다.

실제로는 변경되는 타이밍 등을 하나하나 고려해야 하기에 더 복잡하다.

```ts
const { data, error, isLoading } = useQuery("fetchData", fetchData);
// 이걸로 위에 나온 복잡한 코드들이 똑같이 동작한다.
```

그래서 전역 상태관리는 웬만하면 쓰지 말자.

props drilling 도 무조건 나쁜것인가?

prop을 전달하는 경우 장점 중 하나가 타입을 좁힐 수 있다.

```ts
const [data, setData] = useRecoilState(dataState);

if (!data) return;

return <>{data}</>;
```

위 처럼 항상 initialState인지 아닌지를 고려해야 한다.

```ts
return <>{data ? <Message data={data}></Message> : <Loading />}</>;
```

부모에서 이미 고려 후 전달하는 경우 컴포넌트는 고려할 필요가 없어지고, 재사용성이 증가한다.

Message 컴포넌트는 data가 무조건 들어온다고 판단하고, null check할 필요가 없다.

뿐만 아니라 연결성이 확실하다.

prop 은 부모로부터 자식이 전달받기에, 누가 쓰고있는지 어디서 쓰이는지 확실히 알 수 있다.

그러나 전역 상태관리는 어디서 상태가 설정되는지, 어디서 사용하는지 쉽게 알 수 없고 모호하다.

그래서, redux와 같이 boilerplate과 거대한 전역 상태관리 라이브러리를 사용할 바에는 차라리 최대한 전역 상태관리를 줄이고 react-query 를 사용하는 것이 괜찮아 보인다.

정말로 필요하다면 redux보단 recoil이 괜찮아 보인다.
